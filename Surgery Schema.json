{
    "type": "object",
    "properties": {
        "Specimen ID": {
            "type": "integer"
        },
        "Procedure Date": {
            "type": "string",
            "format": "date"
        },
        "Experimenter first name": {
            "type": "string"
        },
        "Experimenter last name": {
            "type": "string"
        },
        "Protocol ID": {
            "type": "integer"
        },
        "Surgery": {
            "type": "string",
            "enum": ["Head Plate Craniotomy", "Injection"]
        }
    },

    "allof": [
        {
            "if": {
                "properties": {"Surgery": {"const": "Head Plate Craniotomy" } } 
            },
            "then": {
                "properties": {
                    "HPC Coordinates ML": {"type": "number"},
                    "HPC Coordinates AP": {"type": "number"},
                    "HPC Size (mm)": {"type": "number"},
                    "HPC Angle roll (deg)": {"type": "number"},
                    "HPC Angle pitch (deg)": {"type": "number"}
                },
                "required": [
                    "HPC Coordinates ML",
                    "HPC Coordinates AP",
                    "HPC Size (mm)",
                    "HPC Angle roll (deg)",
                    "HPC Angle pitch (deg)"
                    ]
            }
        },
        {
            "if": {
                "properties": {"Surgery": {"const": "Injection"} }
            },
            "then": {
                "properties": {
                    "Injections": {
                        "type": "array",
                        "items": { "$ref": "#/$defs/injecties" },
                        "uniqueitems": true
                        },
                    },
                "required": ["Injections"],
                "$defs": {
                    "injecties": {
                        "type": "object",
                        "properties": {
                            "Injection Coodinates ML": {"type": "number"},
                            "Injection Coordinates AP": {"type": "number"},
                            "Injection Coordinates depth": {"type": "number"},
                            "Injection Angle": {"type": "number"},
                            "Injection Virus": {"type": "string"},
                            "Injection Type": {
                                "type": "string",
                                "enum": ["Iontophoresis","Nanoject"]
                            },
                            "Injection Duration": {
                                "type": "string",
                                "format": "time"
                            }
                        },
                        "allof": [
                            {
                                "if": {
                                    "properties": {"Injection Type": {"const": "Iontophoresis"} }   
                                },
                                "then": {
                                    "properties": {
                                        "Injection Current (uA)": {"type": "number"},
                                        "Alternating Current": {"type": "string"}
                                    },
                                    "required": [
                                        "Injection Current (uA)",
                                        "Alternating Current"
                                    ]
                                }
                            },
                            {
                                "if":{
                                    "properties": {"Injection Type": {"const": "Nanoject"} }
                                },
                                "then": {
                                    "properties": {
                                        "Injection Volume (nL)": {"type": "number"}
                                    },
                                    "required": [
                                        "Injection Volume (nL)"
                                    ]
                                }
                            }
                        ],
                        "required": [
                            "Injection Coordinates ML",
                            "Injection Coordinates AP",
                            "Injection Coordinates depth",
                            "Injection Construct",
                            "Injection Type",
                            "Injection Duration"
                            ]
                    }
                }
            }
        }
    ],
    "required": [
        "Specimen ID",
        "Procedure Date",
        "Experimenter first name",
        "Experimenter last name",
        "Protocol ID",
        "Surgery"
        ]
}

